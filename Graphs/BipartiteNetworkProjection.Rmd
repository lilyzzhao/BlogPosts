---
title: "Bipartite Network Projection"
output:
  html_document:
    df_print: paged
---

```{r, warning=FALSE, message=FALSE}
library(igraph)
library(visNetwork)
```
Often times, we may be interested in how frequently two things occur together. 

A bipartite network is a graphical representation of the relationships *between* two distinct node classes. For example, if we wanted to examine the connections between actors and the movies they acted in, one class of nodes could represent actors and the other node class could represent the movies they star in. For a bipartite network, an edge can only run between actors and movies, not from movies to movies or actors to actors. The following graph is a representation of a bipartite network from the incident matrix *I*. 

```{r}
# Incident matrix to represent bipartite graph.
I <- matrix(c(1, 1, 0, 0,
              0, 1, 1, 0,
              0, 1, 1, 1),
       nrow = 4)

# Name distinct node classes. 
colnames(I) <- c("Jada \n Pinkett Smith", "Mila Kunis", "Kristen Bell")
rownames(I) <- c("Girls Trip", "Bad Moms", "Forgetting \n Sarah Marshall", "Frozen")

# Converting incident matrix to visnetwork object.
net <- toVisNetworkData(graph_from_incidence_matrix(I))

# Use images in nodes. 
pathname <- "https://raw.githubusercontent.com/thatdarndata/BlogPosts/master/Graphs/Pics/"
net$nodes$image <- paste0(pathname, 1:7, ".png")
net$nodes$shape <- c(rep("image", 4), rep("circularImage", 3))

# Plot. 
visNetwork(nodes = net$nodes, edges = net$edges) %>% 
  visIgraphLayout(layout = "layout_as_bipartite") %>% 
  visNodes(shapeProperties = list(useBorderWithImage = TRUE),
           color = list(border = "BDBDBD",
                        background = "BDBDBD",
                        highlight = "BDBDBD")) %>%
  visEdges(shadow = TRUE,
           color = list(color = "BDBDBD", highlight = "3D3D3D")) %>%
  visOptions(highlightNearest = list(enabled = T, hover = T), nodesIdSelection = T)
```

However, we may be interested in the relationships *within* a node class. For instance, you may be interested in knowing how many movies Jada Pinkett Smith and Mila Kunis have appeared in together. We can do this with a one-mode projection onto the actors. In a one-mode projection, the two actor nodes will have an edge connecting them if they star in one or more movies together. Mathematically, this can be represented by the matrix, $P$, where $P = I^TI$.

The diagonals of the matrix P represent the number of movies to which actor *i* belongs. The off-diagonals represent the number of common movies shared by each actor pair.  


```{r}
# Calculate weighted one-mode projection.
P <- t(I) %*% I

# Convert to visnetwork object.
projNet <- toVisNetworkData(graph_from_adjacency_matrix(P, weighted = TRUE, 
                                                        diag = FALSE, mode = 'undirected'))

# Add weights according to edge strength and node size according to diagonals.
projNet$edges$width <- projNet$edges$weight * 2
projNet$nodes$size <- diag(P) * 10
# Use images in nodes. 
projNet$nodes$image <- paste0(pathname, 5:7, ".png")
projNet$nodes$shape <- "circularImage"

# Plot.
visNetwork(nodes = projNet$nodes, edges = projNet$edges) %>% 
  visNodes(shapeProperties = list(useBorderWithImage = TRUE),
           color = list(border = "BDBDBD",
                        background = "BDBDBD",
                        highlight = "BDBDBD")) %>%
  visEdges(color = list(color = "BDBDBD", highlight = "3D3D3D")) 

```





















